/* Import Apple Design System */
@import './styles/apple-design-system.css';

@tailwind base;
@tailwind components;
@tailwind utilities;

/* Base layer overrides */
@layer base {
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  html {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    scroll-behavior: smooth;
  }

  body {
    font-family: var(--font-text);
    font-size: var(--text-base);
    line-height: var(--leading-normal);
    color: var(--text-primary);
    background-color: var(--bg-primary);
    transition: background-color var(--duration-normal) var(--apple-ease), 
                color var(--duration-normal) var(--apple-ease);
  }

  /* Typography overrides */
  h1, h2, h3, h4, h5, h6 {
    font-family: var(--font-display);
    font-weight: var(--font-semibold);
    letter-spacing: var(--tracking-tight);
    line-height: var(--leading-tight);
    color: var(--text-primary);
  }

  /* Apple-style scrollbar */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  ::-webkit-scrollbar-track {
    background: var(--bg-secondary);
  }

  ::-webkit-scrollbar-thumb {
    background: var(--text-tertiary);
    border-radius: 4px;
    transition: background-color var(--duration-normal) var(--apple-ease);
  }

  ::-webkit-scrollbar-thumb:hover {
    background: var(--text-secondary);
  }

  /* Selection styling */
  ::selection {
    background: rgba(0, 122, 255, 0.2);
    color: var(--text-primary);
  }

  /* Focus outline */
  :focus-visible {
    outline: 2px solid var(--apple-blue);
    outline-offset: 2px;
  }
}

/* Component layer styles */
@layer components {
  /* Button styles */
  .btn {
    @apply inline-flex items-center justify-center px-4 py-2 text-sm font-medium rounded-md transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2;
  }

  .btn-primary {
    @apply bg-brand-600 text-white hover:bg-brand-700 focus:ring-brand-500;
  }

  .btn-secondary {
    @apply bg-white border border-gray-200 text-gray-700 hover:bg-gray-50 focus:ring-brand-500;
  }

  .btn-ghost {
    @apply text-gray-600 hover:text-gray-900 hover:bg-gray-100 focus:ring-brand-500;
  }

  /* Input styles */
  .input {
    @apply block w-full px-3 py-2 text-sm border border-gray-200 rounded-md placeholder-gray-400 bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-transparent transition-all duration-200;
    color: #111827 !important;
  }

  .input::placeholder {
    color: #9CA3AF !important;
  }

  .input:focus {
    color: #111827 !important;
  }

  /* Global fix for all input fields */
  input[type="text"],
  input[type="email"],
  input[type="password"],
  input[type="tel"],
  input[type="url"],
  select,
  textarea {
    color: #111827 !important;
  }

  input[type="text"]::placeholder,
  input[type="email"]::placeholder,
  input[type="password"]::placeholder,
  input[type="tel"]::placeholder,
  input[type="url"]::placeholder,
  textarea::placeholder {
    color: #9CA3AF !important;
  }

  input[type="text"]:focus,
  input[type="email"]:focus,
  input[type="password"]:focus,
  input[type="tel"]:focus,
  input[type="url"]:focus,
  select:focus,
  textarea:focus {
    color: #111827 !important;
  }

  .input-error {
    @apply border-error-500 focus:ring-error-500;
  }

  /* Card styles */
  .card {
    @apply bg-white border border-gray-200 rounded-lg shadow-card;
  }

  .card-hover {
    @apply hover:shadow-card-hover transition-shadow duration-200;
  }

  /* Form label */
  .form-label {
    @apply block text-sm font-medium text-gray-700 mb-1;
  }

  /* Sidebar styles */
  .sidebar {
    @apply w-64 bg-white border-r border-gray-200 flex-shrink-0;
  }

  .sidebar-item {
    @apply flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors duration-200;
  }

  .sidebar-item-active {
    @apply bg-brand-50 text-brand-700;
  }

  .sidebar-item-inactive {
    @apply text-gray-600 hover:text-gray-900 hover:bg-gray-50;
  }

  /* Top navigation */
  .topnav {
    @apply h-16 bg-white border-b border-gray-200 flex-shrink-0;
  }

  /* Container styles */
  .container {
    @apply max-w-7xl mx-auto px-6;
  }

  .container-sm {
    @apply max-w-3xl mx-auto px-6;
  }

  .container-xs {
    @apply max-w-md mx-auto px-6;
  }

  /* Modal styles */
  .modal-overlay {
    @apply fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50;
  }

  .modal-content {
    @apply bg-white rounded-xl shadow-modal p-6 max-w-lg w-full mx-4;
  }

  /* Badge styles */
  .badge {
    @apply inline-flex items-center px-2 py-1 text-xs font-medium rounded-full;
  }

  .badge-success {
    @apply bg-success-50 text-success-700;
  }

  .badge-error {
    @apply bg-error-50 text-error-700;
  }

  .badge-warning {
    @apply bg-warning-50 text-warning-700;
  }

  .badge-gray {
    @apply bg-gray-100 text-gray-700;
  }

  /* Loading spinner */
  .spinner {
    @apply animate-spin rounded-full border-2 border-gray-200 border-t-brand-600;
  }

  /* Custom scrollbar */
  .scrollbar-thin {
    scrollbar-width: thin;
    scrollbar-color: #CBD5E1 #F1F5F9;
  }

  .scrollbar-thin::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }

  .scrollbar-thin::-webkit-scrollbar-track {
    background: #F1F5F9;
  }

  .scrollbar-thin::-webkit-scrollbar-thumb {
    background: #CBD5E1;
    border-radius: 3px;
  }

  .scrollbar-thin::-webkit-scrollbar-thumb:hover {
    background: #94A3B8;
  }
}

/* Accessibility: ensure white text isn't used on light backgrounds by mistake.
   This fixes cases where components inherit `text-white` but are placed on
   light cards or backgrounds (e.g. feature cards). It targets common
   light-bg utility classes and card containers and forces a readable
   foreground color while preserving explicit dark-mode white text via
   the `dark:` modifier.
*/
.bg-white :where(.text-white),
.bg-gray-50 :where(.text-white),
.bg-gray-100 :where(.text-white),
.card :where(.text-white),
.card *:where(.text-white) {
  color: var(--text-primary) !important;
}

/* In dark mode, allow explicit white text to remain white */
@media (prefers-color-scheme: dark) {
  .bg-white :where(.text-white),
  .bg-gray-50 :where(.text-white),
  .bg-gray-100 :where(.text-white),
  .card :where(.text-white),
  .card *:where(.text-white) {
    color: white !important;
  }
}

/* Utility layer styles */
@layer utilities {
  .text-balance {
    text-wrap: balance;
  }

  .text-pretty {
    text-wrap: pretty;
  }

  /* Animation utilities */
  .animate-fade-in {
    animation: fadeIn 0.2s ease-out;
  }

  .animate-slide-up {
    animation: slideUp 0.2s ease-out;
  }
}

/* Supabase Auth UI overrides */
@layer components {
  .supabase-auth-ui {
    @apply space-y-4;
  }

  .supabase-auth-ui .sbui-input {
    @apply input;
  }

  .supabase-auth-ui .sbui-button {
    @apply btn btn-primary w-full;
  }

  .supabase-auth-ui .sbui-label {
    @apply form-label;
  }

  .supabase-auth-ui .sbui-error {
    @apply text-error-600 text-sm mt-1;
  }

  .supabase-auth-ui .sbui-anchor {
    @apply text-brand-600 hover:text-brand-700 text-sm;
  }
}
